<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurants across Thailand - Full System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .receipt-font { font-family: 'Sarabun', sans-serif; }
        .pop-in { animation: pop 0.3s ease-out; }
        @keyframes pop { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .orange-gradient { background: linear-gradient(135deg, #ff4d00, #ff8c00); }
        .coupon-gradient { background: linear-gradient(135deg, #ff0055, #ff4d00); }
        .promo-banner { background: linear-gradient(90deg, #ff4d00, #ff0055); }
        .coupon-card { transition: transform 0.2s; }
        .coupon-card:active { transform: scale(0.98); }
        @media print { 
            .no-print { display: none !important; } 
            .print-only { display: block !important; }
            body { background: white; }
        }
    </style>

</head>
<body class="bg-gray-50 text-slate-900 overflow-x-hidden">

    <!-- Promo Banner -->
    <div class="promo-banner text-white py-2 text-center text-xs md:text-sm font-bold no-print shadow-sm z-[110] relative">
        üî• Flash Deal: ‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏ö 500.- ‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 10% | ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏∏‡∏Å‡∏¢‡∏≠‡∏î‡∏ã‡∏∑‡πâ‡∏≠!
    </div>

    <!-- Navbar -->
    <nav class="bg-white/95 backdrop-blur-md shadow-sm sticky top-0 z-[100] no-print">
        <div class="container mx-auto px-4 md:px-6 py-3 flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center space-x-2 cursor-pointer" onclick="switchPage('home')">
                <div class="w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center text-white shadow-md overflow-hidden bg-orange-100">
                    <img src="https://cdn-icons-png.flaticon.com/512/1147/1147810.png" alt="Logo" class="w-8 h-8 md:w-10 md:h-10 object-contain">
                </div>
                <div class="flex flex-col">
                    <span class="text-lg md:text-xl font-bold tracking-tight leading-none">Restaurants</span>
                    <span class="text-sm md:text-base text-orange-600 font-bold leading-none">Thailand</span>
                </div>
            </div>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex space-x-8 font-medium text-sm">
                <a href="javascript:void(0)" onclick="switchPage('home')" id="nav-home" class="text-orange-600 font-bold">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="javascript:void(0)" onclick="switchPage('promo')" id="nav-promo" class="hover:text-orange-600 transition">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</a>
                <a href="#" class="hover:text-orange-600 transition">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
            </div>

            <!-- User & Cart -->
            <div class="flex items-center space-x-3">
                <!-- User Section -->
                <div id="user-section">
                    <button onclick="openAuthModal()" id="login-btn" class="px-4 py-1.5 rounded-full text-xs md:text-sm font-bold border border-orange-600 text-orange-600 hover:bg-orange-600 hover:text-white transition">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                    <!-- User Logged In State -->
                    <div id="user-info" class="hidden flex items-center gap-2 bg-slate-100 pl-1 pr-2 py-1 rounded-full border border-slate-200">
                        <div class="w-8 h-8 rounded-full bg-orange-600 text-white flex items-center justify-center text-xs"><i class="fas fa-user"></i></div>
                        <div class="flex flex-col text-right mr-1">
                            <span id="display-name" class="text-[10px] font-bold leading-none">User</span>
                            <span id="display-points" class="text-[9px] text-orange-600 font-bold leading-none">0 Pts</span>
                        </div>
                        
                        <!-- History Button -->
                        <button onclick="openHistoryModal()" class="w-7 h-7 rounded-full bg-white text-slate-500 hover:text-orange-600 flex items-center justify-center transition shadow-sm border border-slate-100" title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠">
                            <i class="fas fa-history text-xs"></i>
                        </button>
                        
                        <!-- Logout Button -->
                        <button onclick="logout()" class="w-7 h-7 rounded-full bg-white text-slate-400 hover:text-red-500 flex items-center justify-center transition shadow-sm border border-slate-100" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
                            <i class="fas fa-sign-out-alt text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- Cart Toggle -->
                <button onclick="toggleCart()" class="relative p-2.5 bg-orange-50 rounded-full hover:bg-orange-100 transition text-orange-600">
                    <i class="fas fa-shopping-basket text-lg"></i>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] w-4 h-4 flex items-center justify-center rounded-full font-bold border border-white">0</span>
                </button>

                <!-- Mobile Menu Toggle -->
                <button class="md:hidden p-2 text-slate-600" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation Drawer -->
    <div id="mobile-menu" class="fixed inset-0 bg-slate-900/50 z-[110] hidden backdrop-blur-sm no-print">
        <div class="bg-white w-3/4 h-full p-6 shadow-xl animate-slide-in">
            <div class="flex justify-between items-center mb-8">
                <span class="font-bold text-xl">‡πÄ‡∏°‡∏ô‡∏π</span>
                <button onclick="toggleMobileMenu()"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex flex-col space-y-4">
                <a href="#" onclick="switchPage('home'); toggleMobileMenu()" class="py-3 px-4 bg-orange-50 text-orange-600 rounded-xl font-bold">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="#" onclick="switchPage('promo'); toggleMobileMenu()" class="py-3 px-4 hover:bg-gray-50 rounded-xl">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</a>
                <a href="#" onclick="openHistoryModal(); toggleMobileMenu();" class="py-3 px-4 hover:bg-gray-50 rounded-xl flex items-center gap-2">
                    <i class="fas fa-history text-slate-400"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                </a>
            </div>
        </div>
    </div>

    <!-- VIEW: HOME PAGE -->
    <div id="view-home">
        <!-- Hero Section -->
        <section class="bg-white px-4 py-8 md:py-12 no-print border-b">
            <div class="container mx-auto max-w-4xl text-center">
                <h1 class="text-3xl md:text-5xl font-extrabold mb-3 leading-tight text-slate-800">‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢ <br class="md:hidden"><span class="text-orange-600">‡∏ñ‡∏∂‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì</span></h1>
                <p class="text-slate-500 mb-6 text-sm md:text-base">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà ‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏∏‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</p>
                
                <div class="relative max-w-xl mx-auto">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="search-input" onkeyup="filterMenu()" 
                        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£..." 
                        class="w-full pl-12 pr-4 py-3 bg-slate-100 rounded-full border-2 border-transparent focus:border-orange-500 focus:bg-white transition outline-none text-sm shadow-sm">
                </div>
            </div>
        </section>

        <!-- Menu Section -->
        <main class="container mx-auto px-4 py-8">
            <!-- Categories -->
            <div class="flex overflow-x-auto pb-4 mb-6 hide-scroll space-x-2 no-print">
                <button onclick="filterCategory('all')" class="cat-btn flex-shrink-0 px-5 py-2 rounded-full bg-orange-600 text-white font-bold text-sm shadow-md transition">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button onclick="filterCategory('food')" class="cat-btn flex-shrink-0 px-5 py-2 rounded-full bg-white border border-slate-200 text-slate-600 text-sm transition">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
                <button onclick="filterCategory('drink')" class="cat-btn flex-shrink-0 px-5 py-2 rounded-full bg-white border border-slate-200 text-slate-600 text-sm transition">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</button>
                <button onclick="filterCategory('dessert')" class="cat-btn flex-shrink-0 px-5 py-2 rounded-full bg-white border border-slate-200 text-slate-600 text-sm transition">‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô</button>
            </div>

            <!-- Grid -->
            <div id="menu-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6"></div>
        </main>
    </div>

    <!-- VIEW: PROMO PAGE -->
    <div id="view-promo" class="hidden container mx-auto px-4 py-8 pop-in">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-slate-800">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© <i class="fas fa-tags text-orange-600"></i></h2>
            <p class="text-slate-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>
        
        <div id="promo-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Promo Cards Rendered via JS -->
        </div>

        <div class="mt-12 p-6 bg-slate-50 rounded-3xl text-center">
            <h3 class="font-bold text-lg mb-2">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</h3>
            <p class="text-sm text-slate-500">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full sm:w-[420px] bg-white shadow-2xl z-[120] transform translate-x-full transition-transform duration-300 flex flex-col no-print">
        <div class="p-5 border-b flex justify-between items-center bg-white">
            <h2 class="text-lg font-bold flex items-center gap-2"><i class="fas fa-shopping-cart text-orange-600"></i> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <button onclick="toggleCart()" class="w-8 h-8 rounded-full hover:bg-slate-100 flex items-center justify-center"><i class="fas fa-times"></i></button>
        </div>
        
        <div id="cart-items" class="flex-grow overflow-y-auto p-5 space-y-4 bg-slate-50"></div>

        <div class="p-5 bg-white border-t shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
            <!-- Active Coupon Display -->
            <div id="active-coupon-box" class="hidden mb-3 p-3 bg-green-50 border border-green-200 rounded-xl flex justify-between items-center pop-in">
                <div class="flex items-center gap-2">
                    <i class="fas fa-ticket-alt text-green-600"></i>
                    <div>
                        <p class="text-xs font-bold text-green-700" id="ac-code">CODE</p>
                        <p class="text-[10px] text-green-600" id="ac-desc">Description</p>
                    </div>
                </div>
                <button onclick="removeCoupon()" class="text-slate-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>

            <!-- Points Redeem -->
            <div id="redeem-section" class="hidden mb-4 p-3 bg-orange-50 rounded-xl border border-orange-100">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs font-bold text-orange-800"><i class="fas fa-coins text-yellow-500 mr-1"></i> ‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                    <span id="user-total-pts-cart" class="text-[10px] bg-white px-2 py-0.5 rounded-full border border-orange-200 text-orange-600 font-bold">0 Pts</span>
                </div>

                <!-- Special 1000 pts -> 10% Offer -->
                <div id="points-promo-offer" class="mb-3 p-3 bg-white rounded-lg border border-orange-100 text-sm text-slate-700">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <div class="font-bold">‡πÉ‡∏ä‡πâ 1000 ‡πÅ‡∏ï‡πâ‡∏° ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10%</div>
                            <div class="text-xs text-slate-500">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</div>
                        </div>
                        <div>
                            <button id="btn-use-points-promo" onclick="togglePointsPromo()" class="bg-white border border-orange-200 text-orange-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-orange-50">‡πÉ‡∏ä‡πâ</button>
                        </div>
                    </div>
                    <div id="points-promo-status" class="text-xs text-slate-500 hidden">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>

                <div class="flex gap-2">
                    <input type="number" id="use-points-input" class="flex-grow px-3 py-1.5 rounded-lg text-xs border border-orange-200 outline-none focus:border-orange-500" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏ï‡πâ‡∏° (10 Pts = 1.-)">
                    <button onclick="applyPoints()" class="bg-orange-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-orange-700">‡πÉ‡∏ä‡πâ</button>
                </div>
            </div>

            <!-- Pricing Summary -->
            <div class="space-y-1.5 text-sm mb-4">
                <div class="flex justify-between text-slate-500"><span>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span><span id="cart-subtotal">‡∏ø0.00</span></div>
                
                <!-- System Promo (Auto) -->
                <div id="row-promo" class="flex justify-between text-green-600 hidden"><span>‡πÇ‡∏õ‡∏£‡∏Ø ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏Ñ‡∏£‡∏ö 500)</span><span id="val-promo">-‡∏ø0.00</span></div>
                
                <!-- Coupon Promo (Manual) -->
                <div id="row-coupon" class="flex justify-between text-green-600 hidden">
                    <span class="flex items-center gap-1"><i class="fas fa-tag text-xs"></i> <span id="lbl-coupon">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span></span>
                    <span id="val-coupon">-‡∏ø0.00</span>
                </div>

                <div id="row-points" class="flex justify-between text-blue-600 hidden"><span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ï‡πâ‡∏°</span><span id="val-points">-‡∏ø0.00</span></div>
                <div id="row-points-promo" class="flex justify-between text-blue-700 hidden"><span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% (‡πÉ‡∏ä‡πâ 1000 ‡πÅ‡∏ï‡πâ‡∏°)</span><span id="val-points-promo">-‡∏ø0.00</span></div>
                <div class="flex justify-between text-slate-500 text-xs"><span>‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° (VAT 7%)</span><span id="cart-vat">‡∏ø0.00</span></div>
                
                <div class="flex justify-between items-end border-t pt-3 mt-2">
                    <span class="font-bold text-slate-800">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                    <span id="cart-total" class="text-2xl font-bold text-orange-600">‡∏ø0.00</span>
                </div>
            </div>
            
            <button onclick="checkout()" class="w-full orange-gradient text-white py-3.5 rounded-xl font-bold text-base shadow-lg hover:brightness-110 active:scale-[0.98] transition">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
            </button>
        </div>
    </div>

    <!-- History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-slate-900/60 z-[300] hidden items-center justify-center p-4 backdrop-blur-sm no-print">
        <div class="bg-white w-full max-w-lg h-[80vh] rounded-3xl shadow-2xl overflow-hidden pop-in flex flex-col relative">
            <div class="p-6 border-b flex justify-between items-center bg-white z-10">
                <div>
                    <h3 class="text-xl font-bold text-slate-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                    <p class="text-xs text-slate-500">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </div>
                <button onclick="closeHistoryModal()" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center hover:bg-slate-200 text-slate-600"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="history-content" class="flex-grow overflow-y-auto p-6 space-y-4 bg-slate-50">
                <!-- History Items Will Be Injected Here -->
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-slate-900/60 z-[300] hidden items-center justify-center p-4 backdrop-blur-sm no-print">
        <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl overflow-hidden pop-in relative">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
            
            <div class="p-8">
                <div class="text-center mb-6">
                    <h3 id="auth-title" class="text-2xl font-bold text-slate-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    <p class="text-xs text-slate-500 mt-1">‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢</p>
                </div>
                
                <!-- Login Form -->
                <div id="login-form" class="space-y-4">
                    <input type="email" id="login-email" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 focus:border-orange-500 outline-none transition text-sm" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input type="password" id="login-password" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 focus:border-orange-500 outline-none transition text-sm" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <button onclick="handleLogin()" class="w-full orange-gradient text-white py-3 rounded-xl font-bold shadow-lg text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <p class="text-center text-xs text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" onclick="switchAuth('reg')" class="text-orange-600 font-bold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></p>
                </div>

                <!-- Register Form -->
                <div id="reg-form" class="space-y-4 hidden">
                    <input type="text" id="reg-name" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 focus:border-orange-500 outline-none transition text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á">
                    <input type="email" id="reg-email" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 focus:border-orange-500 outline-none transition text-sm" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input type="password" id="reg-password" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 focus:border-orange-500 outline-none transition text-sm" placeholder="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <button onclick="handleRegister()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold shadow-lg text-sm">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    <p class="text-center text-xs text-slate-500">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="switchAuth('login')" class="text-orange-600 font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="fixed inset-0 bg-slate-900/80 z-[200] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl pop-in overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Printable Area -->
            <div id="printable-receipt" class="p-8 receipt-font overflow-y-auto bg-white">
                <div class="text-center mb-6">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-2 text-orange-600 text-xl">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h2 class="text-xl font-bold uppercase tracking-wide">Siam Delights</h2>
                    <p class="text-[10px] text-slate-500 mt-1">123 ‡∏ñ.‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡πÄ‡∏Ç‡∏ï‡∏ß‡∏±‡∏í‡∏ô‡∏≤ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110</p>
                    <p class="text-[10px] text-slate-500">TAX ID: 0105551234567 | ‡πÇ‡∏ó‡∏£: 02-XXX-XXXX</p>
                </div>

                <div class="border-y border-dashed border-slate-300 py-3 my-4 text-[11px] space-y-1 text-slate-600">
                    <div class="flex justify-between"><span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à:</span><span id="rec-id" class="font-mono font-bold text-slate-800"></span></div>
                    <div class="flex justify-between"><span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span><span id="rec-date"></span></div>
                    <div class="flex justify-between"><span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span><span id="rec-customer" class="font-bold text-slate-800"></span></div>
                </div>

                <div class="mb-4">
                    <div class="flex justify-between text-[11px] font-bold border-b border-slate-200 pb-1 mb-2 text-slate-800">
                        <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        <span>‡∏£‡∏ß‡∏°</span>
                    </div>
                    <div id="rec-items-list" class="space-y-1.5 text-[11px] text-slate-600"></div>
                </div>

                <div class="border-t border-dashed border-slate-300 pt-3 space-y-1 text-[11px] text-slate-600">
                    <div class="flex justify-between"><span>‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô (Subtotal)</span><span id="rec-sub"></span></div>
                    
                    <div class="flex justify-between text-green-600 hidden" id="rec-row-disc"><span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (Promo)</span><span id="rec-disc"></span></div>
                    <div class="flex justify-between text-green-600 hidden" id="rec-row-coupon"><span>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á (Coupon)</span><span id="rec-coupon-val"></span></div>
                    <div class="flex justify-between text-blue-700 hidden" id="rec-row-points-promo"><span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏ï‡πâ‡∏° 10% (1000 ‡πÅ‡∏ï‡πâ‡∏°)</span><span id="rec-points-promo-val"></span></div>
                    
                    <div class="flex justify-between"><span>‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7% (VAT)</span><span id="rec-vat-val"></span></div>
                    <div class="flex justify-between text-base font-bold border-t border-double border-slate-300 pt-2 mt-2 text-slate-900">
                        <span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Total)</span><span id="rec-net"></span>
                    </div>
                </div>

                <div id="rec-points-info" class="mt-4 p-2 bg-slate-50 rounded border border-slate-100 text-center hidden">
                    <p class="text-[10px] text-slate-500">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Member Points)</p>
                    <p class="text-xs font-bold text-orange-600">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: <span id="rec-earned"></span> | ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="rec-balance"></span></p>
                </div>

                <div class="mt-6 text-center">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://example.com/pay" class="w-20 h-20 mx-auto mix-blend-multiply opacity-80 mb-2">
                    <p class="text-[9px] font-bold text-slate-400 uppercase">Scan to Pay</p>
                    <p class="text-[9px] text-slate-400 mt-2">*** ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ***</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="p-4 bg-slate-50 flex gap-3 no-print border-t">
                <button onclick="window.print()" class="flex-1 bg-white border border-slate-300 text-slate-700 py-3 rounded-xl font-bold text-sm hover:bg-slate-50 transition flex items-center justify-center gap-2">
                    <i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå
                </button>
                <button onclick="closeReceipt()" class="flex-1 bg-slate-900 text-white py-3 rounded-xl font-bold text-sm hover:bg-black transition">
                    ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" onclick="closeAllMenus()" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-[105] hidden no-print"></div>

    <script type="module">
        // --- DATA ---
      const foodMenu = [
            { id: 101, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏•‡∏∏‡∏Å‡∏Å‡∏∞‡∏õ‡∏¥', price: 50, category: 'food', img: '../food/Savory food101/1001.webp' },
            { id: 102, name: '‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö', price: 60, category: 'food', img: '../food/Savory food101/1002.webp' },
            { id: 103, name: '‡∏™‡∏õ‡∏≤‡πÄ‡∏Å‡∏ï‡∏ï‡∏µ‡πâ‡∏ú‡∏±‡∏î‡∏Ç‡∏µ‡πâ‡πÄ‡∏°‡∏≤‡∏ó‡∏∞‡πÄ‡∏•', price: 79, category: 'food', img: '../food/Savory food101/1003.jpg' },
            { id: 104, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏Å‡πà‡∏ã‡∏≠‡∏™‡πÄ‡∏ó‡∏£‡∏¥‡∏¢‡∏≤‡∏Å‡∏¥', price: 69, category: 'food', img: '../food/Savory food101/1004.webp' },
            { id: 105, name: '‡∏£‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏°‡∏π‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà', price: 40, category: 'food', img: '../food/Savory food101/1005.webp' },
            { id: 106, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö', price: 40, category: 'food', img: '../food/Savory food101/1006.jpg' },
            { id: 107, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö', price: 60, category: 'food', img: '../food/Savory food101/1007.jpg' },
        ];

        // 2. ‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° (Drink) -> ‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 2xx
        const drinkMenu = [
            { id: 201, name: '‡∏ô‡∏°‡∏ä‡∏°‡∏û‡∏π', price: 25, category: 'drink', img: '../food/Beverage201/2001.webp' },
            { id: 202, name: '‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏¢‡πá‡∏ô', price: 35, category: 'drink', img: '../food/Beverage201/2002.jpg' },
            { id: 203, name: '‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡πÄ‡∏¢‡πá‡∏ô', price: 30, category: 'drink', img: '../food/Beverage201/2003.jpg' },
            { id: 204, name: '‡∏ä‡∏≤‡πÄ‡∏•‡∏°‡∏≠‡∏ô', price: 30, category: 'drink', img: '../food/Beverage201/2004.jpg' },
            { id: 205, name: '‡∏Å‡∏≤‡πÅ‡∏ü‡∏•‡∏≤‡πÄ‡∏ï‡πâ‡πÄ‡∏¢‡πá‡∏ô', price: 35, category: 'drink', img: '../food/Beverage201/2005.png' },
            { id: 206, name: '‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏±‡∏ó‡∏â‡∏∞', price: 35, category: 'drink', img: '../food/Beverage201/2006.jpg' },
            { id: 207, name: '‡∏ä‡∏≤‡∏ô‡∏°‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å', price: 35, category: 'drink', img: '../food/Beverage201/2007.jpg' },
        ];

        // 3. ‡∏´‡∏°‡∏ß‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô (Dessert) -> ‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 3xx
        const dessertMenu = [
            { id: 301, name: '‡∏ß‡∏≤‡∏ü‡πÄ‡∏ü‡∏¥‡∏•‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°', price: 79, category: 'dessert', img: '../food/Dessert301/3001.jpg' },
            { id: 302, name: '‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï', price: 15, category: 'dessert', img: '../food/Dessert301/3002.jpg' },
            { id: 303, name: '‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏Å‡∏∞‡∏ó‡∏¥', price: 29, category: 'dessert', img: '../food/Dessert301/3003.jpg' },
            { id: 304, name: '‡πÅ‡∏û‡∏ô‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á', price: 59, category: 'dessert', img: '../food/Dessert301/3004.webp' },
            { id: 305, name: '‡πÄ‡∏â‡∏≤‡∏Å‡πä‡∏ß‡∏¢‡∏ô‡∏°‡∏™‡∏î', price: 20, category: 'dessert', img: '../food/Dessert301/3005.webp' },
            { id: 306, name: '‡πÄ‡∏Ñ‡∏£‡∏õ‡∏´‡∏ß‡∏≤‡∏ô', price: 59, category: 'dessert', img: '../food/Dessert301/3006.webp' },
            { id: 307, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏õ‡∏¥‡πâ‡∏á‡πÄ‡∏ô‡∏¢‡∏ô‡∏°', price: 20, category: 'dessert', img: '../food/Dessert301/3007.jpg' },
            { id: 308, name: '‡∏ö‡∏±‡∏ß‡∏•‡∏≠‡∏¢‡πÑ‡∏Ç‡πà‡∏´‡∏ß‡∏≤‡∏ô', price: 30, category: 'dessert', img: '../food/Dessert301/3008.jpg' },
            { id: 309, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á', price: 60, category: 'dessert', img: '../food/Dessert301/3009.jpg' },
            { id: 310, name: '‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï', price: 35, category: 'dessert', img: '../food/Dessert301/3010.jpg' },
        ];

        const menuData = [...foodMenu, ...drinkMenu, ...dessertMenu];

        const couponsData = [
            { code: 'WELCOME10', title: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö', desc: '‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å', type: 'percent', val: 10, min: 0, cat: null, icon: 'fa-gift' },
            { code: 'FOOD50', title: '‡∏•‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 50.-', desc: '‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 50.- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö 300.-', type: 'fixed', val: 50, min: 300, cat: 'food', icon: 'fa-hamburger' },
            { code: 'DRINK20', title: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏•‡∏î 20%', desc: '‡∏•‡∏î 20% ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°', type: 'percent', val: 20, min: 0, cat: 'drink', icon: 'fa-mug-hot' },
        ];

        let cart = [];
        let currentUser = null;
        let activeCat = 'all';
        let pointsDiscount = 0; 

        // Points promo: when user has >= 1000 points they can use 1000 pts to get 10% off
        let pointsPromoActive = false;
        const POINTS_PROMO_COST = 1000;
        const POINTS_PROMO_PERCENT = 0.10;

        let activeCoupon = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ

        // --- NAVIGATION ---
        function switchPage(page) {
            document.getElementById('view-home').classList.toggle('hidden', page !== 'home');
            document.getElementById('view-promo').classList.toggle('hidden', page !== 'promo');
            
            // Update Active Nav State
            const homeLink = document.getElementById('nav-home');
            const promoLink = document.getElementById('nav-promo');
            
            if(page === 'home') {
                homeLink.classList.add('text-orange-600', 'font-bold');
                promoLink.classList.remove('text-orange-600', 'font-bold');
            } else {
                homeLink.classList.remove('text-orange-600', 'font-bold');
                promoLink.classList.add('text-orange-600', 'font-bold');
                renderPromos();
            }
            closeAllMenus();
        }

        // --- AUTH SYSTEM ---
        function switchAuth(type) {
            const loginF = document.getElementById('login-form');
            const regF = document.getElementById('reg-form');
            const title = document.getElementById('auth-title');
            
            if(type === 'reg') {
                loginF.classList.add('hidden');
                regF.classList.remove('hidden');
                title.innerText = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
            } else {
                loginF.classList.remove('hidden');
                regF.classList.add('hidden');
                title.innerText = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        }

        function openAuthModal() { document.getElementById('auth-modal').classList.remove('hidden'); }
        function closeAuthModal() { document.getElementById('auth-modal').classList.add('hidden'); }

        function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-password').value;

            if(!name || !email || !pass) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");

            let users = JSON.parse(localStorage.getItem('users') || '[]');
            if(users.find(u => u.email === email)) return alert("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß");

            const newUser = { name, email, pass, points: 5000, orders: [] }; 
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ 50 ‡πÅ‡∏ï‡πâ‡∏°");
            switchAuth('login');
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.pass === pass);

            if(user) {
                if(!user.orders) user.orders = [];
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUserUI();
                closeAuthModal();
                updateCart(); 
            } else {
                alert("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            }
        }

        function logout() {
            if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                pointsDiscount = 0;
                activeCoupon = null;
                pointsPromoActive = false;
                updateUserUI();
                updateCart();
            }
        }

        function updateUserUI() {
            const loginBtn = document.getElementById('login-btn');
            const userInfo = document.getElementById('user-info');
            const redeemSec = document.getElementById('redeem-section');
            
            if(currentUser) {
                loginBtn.classList.add('hidden');
                userInfo.classList.remove('hidden');
                redeemSec.classList.remove('hidden');
                document.getElementById('display-name').innerText = currentUser.name;
                document.getElementById('display-points').innerText = `${currentUser.points} Pts`;
                document.getElementById('user-total-pts-cart').innerText = `${currentUser.points} Pts`;
            } else {
                loginBtn.classList.remove('hidden');
                userInfo.classList.add('hidden');
                redeemSec.classList.add('hidden');
            }
        }

        // --- PROMO SYSTEM ---
        function renderPromos() {
            const list = document.getElementById('promo-list');
            // Only show coupons that haven't been marked as used
            list.innerHTML = couponsData.filter(c => !c.used).map(c => `
                <div class="bg-white rounded-2xl p-4 shadow-md border border-slate-100 flex flex-col relative overflow-hidden coupon-card group">
                    <div class="absolute top-0 right-0 bg-orange-100 text-orange-600 px-3 py-1 rounded-bl-xl text-xs font-bold">
                        ${c.type === 'percent' ? c.val + '%' : '‡∏ø' + c.val} OFF
                    </div>
                    <div class="flex items-center gap-4 mb-4 mt-2">
                        <div class="w-12 h-12 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center text-xl">
                            <i class="fas ${c.icon}"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800">${c.title}</h4>
                            <p class="text-xs text-slate-500">${c.code}</p>
                        </div>
                    </div>
                    <p class="text-sm text-slate-600 mb-4 flex-grow">${c.desc}</p>
                    <button onclick="useCoupon('${c.code}')" class="w-full ${activeCoupon && activeCoupon.code === c.code ? 'bg-green-600 text-white' : 'bg-slate-900 text-white'} py-2 rounded-xl text-sm font-bold transition hover:opacity-90">
                        ${activeCoupon && activeCoupon.code === c.code ? '<i class="fas fa-check"></i> ‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà' : '‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ô‡∏µ‡πâ'}
                    </button>
                </div>
            `).join('');
        }

        function useCoupon(code) {
            const coupon = couponsData.find(c => c.code === code);
            if(coupon) {
                activeCoupon = coupon;
                // mark as used so it disappears from the promo list
                coupon.used = true;
                alert(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á ${coupon.title} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
                renderPromos(); // update UI state
                updateCart(); // recalculate price
                // Optionally switch back to menu or open cart
                document.getElementById('cart-sidebar').classList.remove('translate-x-full');
                document.getElementById('overlay').classList.remove('hidden');
            }
        }

        function removeCoupon() {
            if(activeCoupon) {
                // Make the coupon available again
                const coupon = couponsData.find(c => c.code === activeCoupon.code);
                if(coupon) coupon.used = false;
            }
            activeCoupon = null;
            updateCart();
            renderPromos();
        }

        // --- HISTORY SYSTEM ---
        function openHistoryModal() {
            if (!currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
            const historyContent = document.getElementById('history-content');
            const orders = currentUser.orders || [];

            if(orders.length === 0) {
                historyContent.innerHTML = `<div class="text-center py-10 text-slate-400"><i class="fas fa-history text-4xl mb-3 opacity-50"></i><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p></div>`;
            } else {
                const sortedOrders = [...orders].reverse();
                historyContent.innerHTML = sortedOrders.map(order => `
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div class="flex justify-between items-start mb-2 pb-2 border-b border-dashed border-slate-200">
                            <div><span class="text-xs font-bold text-slate-400 block">Order #${order.id}</span><span class="text-xs text-slate-600">${order.date}</span></div>
                            <span class="text-orange-600 font-bold">‡∏ø${order.netTotal.toLocaleString()}</span>
                        </div>
                        <div class="space-y-1 mb-2">${order.items.map(item => `<div class="flex justify-between text-xs text-slate-500"><span>${item.name} x${item.qty}</span><span>‡∏ø${(item.price * item.qty).toLocaleString()}</span></div>`).join('')}</div>
                        ${order.couponDiscount > 0 ? `<div class="flex justify-between text-xs text-green-600 border-t pt-1 border-dashed"><span>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á (${order.couponCode})</span><span>-‡∏ø${order.couponDiscount.toLocaleString()}</span></div>` : ''}
                        ${order.promoDiscount > 0 ? `<div class="flex justify-between text-xs text-green-600"><span>‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span><span>-‡∏ø${order.promoDiscount.toLocaleString()}</span></div>` : ''}
                        <div class="flex justify-between text-[10px] text-slate-400 mt-2"><span>‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ: ${order.earnedPoints}</span><span class="text-green-600 font-bold">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span></div>
                    </div>
                `).join('');
            }
            document.getElementById('history-modal').classList.remove('hidden');
            document.getElementById('history-modal').classList.add('flex');
        }

        function closeHistoryModal() {
            document.getElementById('history-modal').classList.add('hidden');
            document.getElementById('history-modal').classList.remove('flex');
        }

        // --- MENU & CART ---
        function renderMenu(items) {
            const grid = document.getElementById('menu-grid');
            if(items.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-10 text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>`;
                return;
            }
            grid.innerHTML = items.map(item => `
                <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition-all border border-slate-100 flex flex-col pop-in group">
                    <div class="h-40 relative overflow-hidden">
                        <img src="${item.img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                        <span class="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider text-slate-600 shadow-sm border border-slate-100">${item.category}</span>
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-bold text-slate-800 text-sm mb-1 line-clamp-1">${item.name}</h3>
                        <p class="text-orange-600 font-bold text-lg">‡∏ø${item.price}</p>
                        <button onclick="addToCart(${item.id})" class="mt-3 w-full bg-slate-50 text-slate-900 border border-slate-200 py-2 rounded-xl text-xs font-bold hover:bg-slate-900 hover:text-white transition flex items-center justify-center gap-2">
                            <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterCategory(cat) {
            activeCat = cat;
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.classList.remove('bg-orange-600', 'text-white', 'shadow-md');
                b.classList.add('bg-white', 'text-slate-600', 'border');
            });
            event.target.classList.add('bg-orange-600', 'text-white', 'shadow-md');
            event.target.classList.remove('bg-white', 'text-slate-600', 'border');
            filterMenu();
        }

        function filterMenu() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const filtered = menuData.filter(i => (activeCat === 'all' || i.category === activeCat) && (i.name.toLowerCase().includes(q)));
            renderMenu(filtered);
        }

        function addToCart(id) {
            const item = menuData.find(i => i.id === id);
            const exists = cart.find(c => c.id === id);
            if (exists) exists.qty++; else cart.push({...item, qty: 1});
            if(cart.length === 1 && cart[0].qty === 1) {
                document.getElementById('cart-sidebar').classList.remove('translate-x-full');
                document.getElementById('overlay').classList.remove('hidden');
            }
            updateCart();
        }

        function changeQty(id, delta) {
            const item = cart.find(i => i.id === id);
            if(!item) return;
            item.qty += delta;
            if(item.qty <= 0) cart = cart.filter(i => i.id !== id);
            updateCart();
        }

        function applyPoints() {
            if(!currentUser) return;
            const input = document.getElementById('use-points-input');
            const pts = parseInt(input.value);
            if(!pts || pts <= 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏°");
            if(pts > currentUser.points) return alert("‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
            if(pts < 10) return alert("‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 10 ‡πÅ‡∏ï‡πâ‡∏°");
            pointsDiscount = Math.floor(pts / 10);
            input.value = '';
            updateCart();
        }

        function togglePointsPromo() {
            if(!currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πâ‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô");
            // Toggle off
            if(pointsPromoActive) {
                if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô 1000 ‡πÅ‡∏ï‡πâ‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
                pointsPromoActive = false;
                updateCart();
                return;
            }

            // Try enable
            if(currentUser.points < POINTS_PROMO_COST) return alert("‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ô‡∏µ‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1000 ‡πÅ‡∏ï‡πâ‡∏°)");
            if(!confirm("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ï‡πâ‡∏° 1000 ‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ? ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ô‡∏µ‡πâ.")) return;
            pointsPromoActive = true;
            updateCart();
        }

        function updateCart() {
            const list = document.getElementById('cart-items');
            
            if(cart.length === 0) {
                list.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-slate-300"><i class="fas fa-shopping-basket text-4xl mb-2"></i><p class="text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p></div>`;
                document.getElementById('cart-subtotal').innerText = '‡∏ø0.00';
                document.getElementById('cart-vat').innerText = '‡∏ø0.00';
                document.getElementById('cart-total').innerText = '‡∏ø0.00';
                document.getElementById('cart-count').innerText = 0;
                pointsDiscount = 0;
                updatePricing(0);
                return;
            }

            let count = 0;
            let subtotal = 0;
            list.innerHTML = cart.map(item => {
                count += item.qty;
                subtotal += item.price * item.qty;
                return `
                    <div class="flex gap-3 items-center bg-white p-3 rounded-xl border border-slate-100 shadow-sm">
                        <img src="${item.img}" class="w-12 h-12 rounded-lg object-cover">
                        <div class="flex-grow min-w-0">
                            <h4 class="font-bold text-sm truncate">${item.name}</h4>
                            <p class="text-orange-600 text-xs font-bold">‡∏ø${item.price}</p>
                        </div>
                        <div class="flex items-center gap-2 bg-slate-100 rounded-lg p-1">
                            <button onclick="changeQty(${item.id}, -1)" class="w-5 h-5 flex items-center justify-center bg-white rounded shadow-sm text-xs hover:text-red-500"><i class="fas fa-minus"></i></button>
                            <span class="text-xs font-bold w-4 text-center">${item.qty}</span>
                            <button onclick="changeQty(${item.id}, 1)" class="w-5 h-5 flex items-center justify-center bg-white rounded shadow-sm text-xs hover:text-green-600"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('cart-count').innerText = count;
            updatePricing(subtotal);
        }

        function updatePricing(subtotal) {
            // 1. Standard Auto Promo (>500 get 10%)
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Coupon ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Auto Promo (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢)
            // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Active Coupon -> ‡πÉ‡∏ä‡πâ Coupon, ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ -> ‡πÉ‡∏ä‡πâ Auto
            
            let promoDisc = 0;
            let couponDisc = 0;

            // Calculate Coupon Discount
            if(activeCoupon) {
                // Check conditions
                let eligibleAmount = subtotal;
                
                // Filter Category specific
                if(activeCoupon.cat) {
                    eligibleAmount = cart.filter(i => i.category === activeCoupon.cat).reduce((sum, i) => sum + (i.price * i.qty), 0);
                }

                if(subtotal >= activeCoupon.min) {
                    if(activeCoupon.type === 'percent') {
                        couponDisc = eligibleAmount * (activeCoupon.val / 100);
                    } else {
                        couponDisc = activeCoupon.val;
                    }
                    // Max discount check could go here
                }
            }

            // Calculate Auto Promo (Only if no coupon is active OR enable stacking logic here)
            // Let's make them MUTUALLY EXCLUSIVE for simplicity -> Coupon overrides Auto Promo
            if(!activeCoupon && subtotal >= 500) {
                promoDisc = subtotal * 0.10;
            }

            // Render UI for Discounts
            const promoRow = document.getElementById('row-promo');
            const couponRow = document.getElementById('row-coupon');
            const activeCouponBox = document.getElementById('active-coupon-box');

            if(promoDisc > 0) {
                promoRow.classList.remove('hidden');
                document.getElementById('val-promo').innerText = `-‡∏ø${promoDisc.toFixed(2)}`;
            } else {
                promoRow.classList.add('hidden');
            }

            if(activeCoupon) {
                activeCouponBox.classList.remove('hidden');
                document.getElementById('ac-code').innerText = activeCoupon.code;
                document.getElementById('ac-desc').innerText = activeCoupon.desc;

                if(couponDisc > 0) {
                    couponRow.classList.remove('hidden');
                    document.getElementById('lbl-coupon').innerText = `‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á ${activeCoupon.code}`;
                    document.getElementById('val-coupon').innerText = `-‡∏ø${couponDisc.toFixed(2)}`;
                } else {
                    couponRow.classList.add('hidden'); // Coupon active but conditions not met (e.g. min spend)
                }
            } else {
                activeCouponBox.classList.add('hidden');
                couponRow.classList.add('hidden');
            }

            // Points Promo (1000 pts -> 10%)
            let pointsPromoDisc = 0;
            if(pointsPromoActive && currentUser) {
                if(currentUser.points >= POINTS_PROMO_COST) {
                    pointsPromoDisc = subtotal * POINTS_PROMO_PERCENT;
                    pointsPromoDisc = Math.min(pointsPromoDisc, subtotal - promoDisc - couponDisc);
                } else {
                    // no longer eligible
                    pointsPromoActive = false;
                }
            }

            // Points Discount (manual redemption)
            if(pointsDiscount > 0) {
                // Cap points discount to remaining after other discounts and points promo
                if(pointsDiscount > (subtotal - promoDisc - couponDisc - pointsPromoDisc)) pointsDiscount = Math.max(0, subtotal - promoDisc - couponDisc - pointsPromoDisc);
                document.getElementById('row-points').classList.remove('hidden');
                document.getElementById('val-points').innerText = `-‡∏ø${pointsDiscount.toFixed(2)}`;
            } else {
                document.getElementById('row-points').classList.add('hidden');
            }

            if(pointsPromoDisc > 0) {
                document.getElementById('row-points-promo').classList.remove('hidden');
                document.getElementById('val-points-promo').innerText = `-‡∏ø${pointsPromoDisc.toFixed(2)}`;
                document.getElementById('points-promo-status').classList.remove('hidden');
                document.getElementById('btn-use-points-promo').innerText = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
            } else {
                document.getElementById('row-points-promo').classList.add('hidden');
                document.getElementById('points-promo-status').classList.add('hidden');
                document.getElementById('btn-use-points-promo').innerText = '‡πÉ‡∏ä‡πâ';
            }

            const afterDisc = Math.max(0, subtotal - promoDisc - couponDisc - pointsPromoDisc - pointsDiscount);
            const vat = afterDisc * 0.07;
            const netTotal = afterDisc + vat;

            document.getElementById('cart-subtotal').innerText = `‡∏ø${subtotal.toFixed(2)}`;
            document.getElementById('cart-vat').innerText = `‡∏ø${vat.toFixed(2)}`;
            document.getElementById('cart-total').innerText = `‡∏ø${netTotal.toFixed(2)}`;

            return { subtotal, promoDisc, couponDisc, pointsDiscount, pointsPromoDisc, vat, netTotal };
        }

        import {saveOrder} from "./Database.js";

        // --- CHECKOUT & RECEIPT ---
        function checkout() {
            if(cart.length === 0) return;
            
            let subtotal = 0;
            cart.forEach(i => subtotal += i.price * i.qty);
            const pricing = updatePricing(subtotal);
            const now = new Date();
            const orderId = 'INV-' + Math.floor(100000 + Math.random() * 900000);
            const dateStr = now.toLocaleString('th-TH');

            let earnedPoints = 0;
            if(currentUser) {
                if(pointsDiscount > 0) currentUser.points -= (pointsDiscount * 10);

                // If user used the 1000-points promo, deduct the flat 1000 pts and record the discount
                if(pointsPromoActive) {
                    currentUser.points -= POINTS_PROMO_COST;
                }

                earnedPoints = Math.floor(pricing.netTotal / 25);
                currentUser.points += earnedPoints;

                const newOrder = {
                    id: orderId,
                    // +++ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö +++
                    userEmail: currentUser.email,  // ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
                    userName: currentUser.name,    // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                    // -----------------------------
                    date: dateStr,
                    items: [...cart],
                    subtotal: pricing.subtotal,
                    promoDiscount: pricing.promoDisc,
                    couponDiscount: pricing.couponDisc,
                    couponCode: activeCoupon ? activeCoupon.code : null,
                    pointsPromoUsed: pointsPromoActive,
                    pointsPromoValue: pricing.pointsPromoDisc || 0,
                    vat: pricing.vat,
                    netTotal: pricing.netTotal,
                    earnedPoints: earnedPoints
                };

                if(!currentUser.orders) currentUser.orders = [];
                currentUser.orders.push(newOrder);

                let users = JSON.parse(localStorage.getItem('users') || '[]');
                users = users.map(u => u.email === currentUser.email ? currentUser : u);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserUI();
                saveOrder(newOrder);
            }

            document.getElementById('rec-id').innerText = orderId;
            document.getElementById('rec-date').innerText = dateStr;
            document.getElementById('rec-customer').innerText = currentUser ? currentUser.name : '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';

            document.getElementById('rec-items-list').innerHTML = cart.map(i => `<div class="flex justify-between"><div class="flex flex-col"><span>${i.name}</span><span class="text-[9px] text-slate-400">@${i.price} x ${i.qty}</span></div><span class="font-bold">‡∏ø${(i.price * i.qty).toFixed(2)}</span></div>`).join('');

            document.getElementById('rec-sub').innerText = `‡∏ø${pricing.subtotal.toFixed(2)}`;
            document.getElementById('rec-vat-val').innerText = `‡∏ø${pricing.vat.toFixed(2)}`;
            document.getElementById('rec-net').innerText = `‡∏ø${pricing.netTotal.toFixed(2)}`;

            // Receipt Discounts
            if(pricing.promoDisc > 0) {
                document.getElementById('rec-row-disc').classList.remove('hidden');
                document.getElementById('rec-disc').innerText = `-‡∏ø${pricing.promoDisc.toFixed(2)}`;
            } else {
                document.getElementById('rec-row-disc').classList.add('hidden');
            }

            if(pricing.couponDisc > 0) {
                document.getElementById('rec-row-coupon').classList.remove('hidden');
                document.getElementById('rec-coupon-val').innerText = `-‡∏ø${pricing.couponDisc.toFixed(2)}`;
            } else {
                document.getElementById('rec-row-coupon').classList.add('hidden');
            }

            if(pricing.pointsPromoDisc > 0) {
                document.getElementById('rec-row-points-promo').classList.remove('hidden');
                document.getElementById('rec-points-promo-val').innerText = `-‡∏ø${pricing.pointsPromoDisc.toFixed(2)}`;
            } else {
                document.getElementById('rec-row-points-promo').classList.add('hidden');
            }

            if(currentUser) {
                document.getElementById('rec-points-info').classList.remove('hidden');
                document.getElementById('rec-earned').innerText = `+${earnedPoints}`;
                document.getElementById('rec-balance').innerText = currentUser.points;
            }

            document.getElementById('receipt-modal').classList.remove('hidden');
            document.getElementById('receipt-modal').classList.add('flex');


        }

        function closeReceipt() {
            document.getElementById('receipt-modal').classList.remove('flex');
            document.getElementById('receipt-modal').classList.add('hidden');
            cart = [];
            pointsDiscount = 0;
            activeCoupon = null; // Reset coupon after purchase
            pointsPromoActive = false; // Reset promo after purchase
            updateCart();
            toggleCart();
        }

        function toggleCart() {
            const sb = document.getElementById('cart-sidebar');
            const ov = document.getElementById('overlay');
            if(sb.classList.contains('translate-x-full')) {
                sb.classList.remove('translate-x-full');
                ov.classList.remove('hidden');
            } else {
                sb.classList.add('translate-x-full');
                ov.classList.add('hidden');
            }
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function closeAllMenus() {
            document.getElementById('cart-sidebar').classList.add('translate-x-full');
            document.getElementById('mobile-menu').classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
        }

        window.onload = () => {
            const savedUser = localStorage.getItem('currentUser');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                if(!currentUser.orders) currentUser.orders = [];
                updateUserUI();
            }
            renderMenu(menuData);
        };


        // +++ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÉ‡∏ô HTML ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ) +++
            window.switchPage = switchPage;
            window.openAuthModal = openAuthModal;
            window.closeAuthModal = closeAuthModal;
            window.handleLogin = handleLogin;
            window.handleRegister = handleRegister;
            window.logout = logout;
            window.toggleCart = toggleCart;
            window.addToCart = addToCart;
            window.changeQty = changeQty;
            window.filterCategory = filterCategory;
            window.filterMenu = filterMenu;
            window.checkout = checkout;       // <--- ‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
            window.closeReceipt = closeReceipt;
            window.switchAuth = switchAuth;
            window.toggleMobileMenu = toggleMobileMenu;
            window.openHistoryModal = openHistoryModal;
            window.closeHistoryModal = closeHistoryModal;
            window.useCoupon = useCoupon;
            window.removeCoupon = removeCoupon;
            window.togglePointsPromo = togglePointsPromo;
            window.applyPoints = applyPoints;
    </script>
    <script type="module" src="Database.js"></script>
</body>
</html>